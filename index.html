<!-- Remplacez la section DONNÉES DE DÉMO (lignes 584-603) par ceci : -->

<script>
// ═══════════════════════════════════════════════════════════════
// CONNEXION GOOGLE SHEETS VIA APPS SCRIPT
// ═══════════════════════════════════════════════════════════════

// ⚠️ IMPORTANT : Remplacez par l'URL de votre Web App Apps Script
const API_URL = 'https://script.google.com/macros/s/AKfycbwB1ce6D4jsHV4g_NMqBfzVURbaK2j2OPDk3QAEV8GkIyTn63AQYCcdmbjJ8C5KE3dbaw/exec';

// Données par défaut (pour éviter les erreurs au chargement)
let DATA = {
  mois: {
    achats: [],
    ventes: []
  }
};

const CFG = {
  objectifFoodCost:    0.28,
  objectifBevCost:     0.22,
  objectifTicketMoyen: 38.00,
  alerteTresorerie:    2000,
  tauxChargesFixes:    0.35,
  tauxPersonnel:       0.30,
};

// ═══════════════════════════════════════════════════════════════
// CHARGER LES DONNÉES DEPUIS GOOGLE SHEETS
// ═══════════════════════════════════════════════════════════════
async function loadData() {
  try {
    const response = await fetch(API_URL);
    if (!response.ok) throw new Error('Erreur API: ' + response.status);
    
    const data = await response.json();
    
    // Mettre à jour DATA avec les données du Sheet
    DATA.mois = {
      achats: data.achats || [],
      ventes: data.ventes || []
    };
    
    // Afficher la dernière mise à jour
    if (data.lastUpdate) {
      console.log('Données chargées:', new Date(data.lastUpdate).toLocaleString('fr-FR'));
    }
    
    // Re-render le dashboard avec les nouvelles données
    render('mois');
    
  } catch (error) {
    console.error('Erreur chargement données:', error);
    document.querySelector('.badge-live').innerHTML = 
      '<span style="width:8px;height:8px;background:var(--red);border-radius:50%;display:inline-block"></span> ERREUR';
  }
}

// ═══════════════════════════════════════════════════════════════
// AUTO-REFRESH TOUTES LES 15 MINUTES
// ═══════════════════════════════════════════════════════════════
function startAutoRefresh() {
  // Charger immédiatement
  loadData();
  
  // Puis recharger toutes les 15 minutes
  setInterval(loadData, 15 * 60 * 1000);
}

// ═══════════════════════════════════════════════════════════════
// HELPERS (reste inchangé)
// ═══════════════════════════════════════════════════════════════
const fmt  = v => new Intl.NumberFormat('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}).format(v) + ' €';
const fmtK = v => v >= 1000 ? (v/1000).toFixed(1).replace('.',',') + 'k €' : fmt(v);
const fmtP = v => (v*100).toFixed(1).replace('.',',') + '%';
const fmtI = v => Math.round(v).toLocaleString('fr-FR');
const qs   = s => document.querySelector(s);
const diff = (d1,d2) => Math.ceil((new Date(d2)-new Date(d1))/(86400000));

// ... (reste du code inchangé) ...

// ═══════════════════════════════════════════════════════════════
// INIT - Remplacez la ligne 980 par :
// ═══════════════════════════════════════════════════════════════
document.addEventListener('DOMContentLoaded', () => startAutoRefresh());
</script>
