<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHR 360Â° â€” Pilotage Restaurant</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:        #0a0a0f;
    --surface:   #12121a;
    --card:      #1a1a26;
    --border:    #2a2a3d;
    --accent:    #f0a500;
    --accent2:   #e05c5c;
    --accent3:   #4ecdc4;
    --green:     #2ecc71;
    --red:       #e74c3c;
    --orange:    #f39c12;
    --text:      #f0f0f0;
    --muted:     #8888a0;
    --dim:       #55556a;
    --font-head: 'DM Serif Display', serif;
    --font-body: 'DM Sans', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    --r:         12px;
    --r-lg:      20px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { scroll-behavior: smooth; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-body);
    font-size: 14px;
    line-height: 1.5;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ NOISE OVERLAY â”€â”€ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.6;
  }

  /* â”€â”€ GLOW BG â”€â”€ */
  .bg-glow {
    position: fixed;
    width: 600px; height: 600px;
    border-radius: 50%;
    filter: blur(120px);
    pointer-events: none;
    z-index: 0;
    opacity: 0.12;
  }
  .bg-glow-1 { background: var(--accent); top: -200px; left: -100px; }
  .bg-glow-2 { background: var(--accent3); bottom: -200px; right: -100px; }

  /* â”€â”€ LAYOUT â”€â”€ */
  .app { position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; padding: 28px 24px 60px; }

  /* â”€â”€ HEADER â”€â”€ */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 36px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border);
    animation: fadeDown 0.6s ease both;
  }
  .header-left { display: flex; align-items: center; gap: 16px; }
  .logo-mark {
    width: 48px; height: 48px;
    background: linear-gradient(135deg, var(--accent), #c07800);
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    box-shadow: 0 0 30px rgba(240,165,0,0.3);
  }
  .header-title { font-family: var(--font-head); font-size: 26px; letter-spacing: -0.5px; }
  .header-subtitle { color: var(--muted); font-size: 12px; font-weight: 400; margin-top: 2px; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  .badge-live {
    display: flex; align-items: center; gap: 7px;
    background: rgba(46,204,113,0.12);
    border: 1px solid rgba(46,204,113,0.3);
    padding: 6px 14px; border-radius: 100px;
    font-size: 11px; font-weight: 600; color: var(--green);
    letter-spacing: 0.5px;
  }
  .badge-live .dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--green);
    animation: pulse 2s infinite;
  }
  .date-chip {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 6px 14px; border-radius: 100px;
    font-size: 11px; color: var(--muted);
    font-family: var(--font-mono);
  }

  /* â”€â”€ PERIOD TABS â”€â”€ */
  .period-tabs {
    display: flex; gap: 4px;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 4px;
    border-radius: 100px;
    margin-bottom: 28px;
    width: fit-content;
    animation: fadeDown 0.7s ease both;
  }
  .tab {
    padding: 7px 20px; border-radius: 100px;
    font-size: 12px; font-weight: 500;
    cursor: pointer; transition: all 0.2s;
    color: var(--muted); border: none; background: none;
  }
  .tab.active {
    background: var(--accent);
    color: #000;
    font-weight: 600;
  }
  .tab:hover:not(.active) { color: var(--text); }

  /* â”€â”€ SECTION LABELS â”€â”€ */
  .section-label {
    font-size: 10px; font-weight: 600;
    letter-spacing: 2px; text-transform: uppercase;
    color: var(--dim); margin-bottom: 14px; margin-top: 32px;
  }
  .section-label:first-child { margin-top: 0; }

  /* â”€â”€ GRID â”€â”€ */
  .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
  .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
  .grid-2-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; }
  .grid-1-2 { display: grid; grid-template-columns: 1fr 2fr; gap: 16px; }

  /* â”€â”€ CARD â”€â”€ */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--r-lg);
    padding: 22px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s, transform 0.2s;
    animation: fadeUp 0.5s ease both;
  }
  .card:hover { border-color: var(--dim); transform: translateY(-1px); }
  .card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(600px circle at var(--mouse-x,50%) var(--mouse-y,50%), rgba(240,165,0,0.04), transparent 40%);
    pointer-events: none;
  }
  .card-label {
    font-size: 10px; font-weight: 600;
    letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--muted); margin-bottom: 10px;
    display: flex; align-items: center; gap: 6px;
  }
  .card-value {
    font-family: var(--font-mono);
    font-size: 28px; font-weight: 600;
    letter-spacing: -1px; line-height: 1;
    margin-bottom: 4px;
  }
  .card-value.lg { font-size: 36px; }
  .card-sub { font-size: 12px; color: var(--muted); }
  .card-delta {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 11px; font-weight: 600;
    padding: 3px 8px; border-radius: 6px;
    margin-top: 8px;
  }
  .delta-up   { background: rgba(46,204,113,0.15); color: var(--green); }
  .delta-down { background: rgba(231,76,60,0.15);  color: var(--red); }
  .delta-warn { background: rgba(243,156,18,0.15); color: var(--orange); }

  /* â”€â”€ ACCENT LINE â”€â”€ */
  .accent-line {
    position: absolute;
    bottom: 0; left: 22px; right: 22px;
    height: 2px; border-radius: 2px;
    background: linear-gradient(90deg, var(--accent), transparent);
  }
  .accent-line.green  { background: linear-gradient(90deg, var(--green), transparent); }
  .accent-line.red    { background: linear-gradient(90deg, var(--red), transparent); }
  .accent-line.teal   { background: linear-gradient(90deg, var(--accent3), transparent); }
  .accent-line.orange { background: linear-gradient(90deg, var(--orange), transparent); }

  /* â”€â”€ GAUGE â”€â”€ */
  .gauge-wrap { display: flex; flex-direction: column; align-items: center; padding: 8px 0; }
  .gauge-svg { width: 140px; height: 80px; overflow: visible; }
  .gauge-track { fill: none; stroke: var(--border); stroke-width: 10; stroke-linecap: round; }
  .gauge-fill  { fill: none; stroke-width: 10; stroke-linecap: round; transition: stroke-dashoffset 1.4s cubic-bezier(0.4,0,0.2,1); }
  .gauge-value { font-family: var(--font-mono); font-size: 20px; font-weight: 600; fill: var(--text); }
  .gauge-label { font-size: 11px; color: var(--muted); margin-top: 6px; text-align: center; }
  .gauge-obj   { font-size: 10px; color: var(--dim); margin-top: 2px; }

  /* â”€â”€ WATERFALL / BAR â”€â”€ */
  .chart-area { padding: 8px 0; }
  .bar-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .bar-row-label { font-size: 11px; color: var(--muted); width: 120px; flex-shrink: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .bar-track { flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
  .bar-fill  { height: 100%; border-radius: 4px; transition: width 1.2s cubic-bezier(0.4,0,0.2,1); width: 0; }
  .bar-amount { font-size: 11px; font-family: var(--font-mono); color: var(--text); width: 80px; text-align: right; flex-shrink: 0; }

  /* â”€â”€ MINI SPARKLINE â”€â”€ */
  .sparkline { width: 100%; height: 50px; }
  .sparkline-line { fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
  .sparkline-area { stroke: none; }

  /* â”€â”€ TABLE â”€â”€ */
  .table-wrap { overflow-x: auto; margin-top: 6px; }
  table { width: 100%; border-collapse: collapse; }
  th {
    font-size: 10px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; color: var(--muted);
    padding: 10px 14px; text-align: left;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
  }
  td {
    padding: 11px 14px;
    border-bottom: 1px solid rgba(42,42,61,0.5);
    font-size: 12px; vertical-align: middle;
  }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(255,255,255,0.02); }
  .mono { font-family: var(--font-mono); }
  .pill {
    display: inline-block;
    padding: 3px 9px; border-radius: 6px;
    font-size: 10px; font-weight: 600; letter-spacing: 0.5px;
  }
  .pill-green  { background: rgba(46,204,113,0.15); color: var(--green); }
  .pill-red    { background: rgba(231,76,60,0.15);  color: var(--red); }
  .pill-orange { background: rgba(243,156,18,0.15); color: var(--orange); }
  .pill-blue   { background: rgba(78,205,196,0.15); color: var(--accent3); }

  /* â”€â”€ ALERTS â”€â”€ */
  .alert-card {
    display: flex; gap: 14px; align-items: flex-start;
    padding: 14px 18px;
    border-radius: var(--r);
    border: 1px solid;
    margin-bottom: 10px;
    animation: slideIn 0.4s ease both;
  }
  .alert-card:last-child { margin-bottom: 0; }
  .alert-ok     { background: rgba(46,204,113,0.07);  border-color: rgba(46,204,113,0.2); }
  .alert-warn   { background: rgba(243,156,18,0.07);  border-color: rgba(243,156,18,0.2); }
  .alert-danger { background: rgba(231,76,60,0.07);   border-color: rgba(231,76,60,0.2); }
  .alert-icon { font-size: 18px; flex-shrink: 0; line-height: 1.4; }
  .alert-text strong { display: block; font-size: 12px; font-weight: 600; margin-bottom: 2px; }
  .alert-text span   { font-size: 11px; color: var(--muted); }

  /* â”€â”€ DIVIDER â”€â”€ */
  .divider { border: none; border-top: 1px solid var(--border); margin: 28px 0; }

  /* â”€â”€ TRESORERIE TIMELINE â”€â”€ */
  .timeline { display: flex; flex-direction: column; gap: 8px; }
  .timeline-item {
    display: flex; align-items: center; gap: 14px;
    padding: 12px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--r);
    transition: border-color 0.2s;
  }
  .timeline-item:hover { border-color: var(--dim); }
  .timeline-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  .timeline-date { font-family: var(--font-mono); font-size: 11px; color: var(--muted); width: 80px; flex-shrink: 0; }
  .timeline-name { flex: 1; font-size: 12px; font-weight: 500; }
  .timeline-cat  { font-size: 10px; color: var(--dim); }
  .timeline-amount { font-family: var(--font-mono); font-size: 13px; font-weight: 600; flex-shrink: 0; }
  .timeline-days { font-size: 10px; color: var(--muted); flex-shrink: 0; width: 55px; text-align: right; }

  /* â”€â”€ FOOTER â”€â”€ */
  .footer {
    margin-top: 48px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
  }
  .footer-left { font-size: 11px; color: var(--dim); }
  .footer-right { display: flex; gap: 8px; }
  .footer-tag {
    font-size: 10px; color: var(--dim);
    border: 1px solid var(--border);
    padding: 3px 9px; border-radius: 6px;
    font-family: var(--font-mono);
  }

  /* â”€â”€ ANIMATIONS â”€â”€ */
  @keyframes fadeUp   { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:none; } }
  @keyframes fadeDown { from { opacity:0; transform:translateY(-12px); } to { opacity:1; transform:none; } }
  @keyframes slideIn  { from { opacity:0; transform:translateX(-10px); } to { opacity:1; transform:none; } }
  @keyframes pulse    { 0%,100%{opacity:1;} 50%{opacity:0.3;} }
  @keyframes countUp  { from { opacity:0; } to { opacity:1; } }

  .card:nth-child(1) { animation-delay: 0.05s; }
  .card:nth-child(2) { animation-delay: 0.10s; }
  .card:nth-child(3) { animation-delay: 0.15s; }
  .card:nth-child(4) { animation-delay: 0.20s; }
  .card:nth-child(5) { animation-delay: 0.25s; }
  .card:nth-child(6) { animation-delay: 0.30s; }

  /* â”€â”€ RESPONSIVE TABLETTE â”€â”€ */
  @media (max-width: 900px) {
    .grid-4 { grid-template-columns: repeat(2, 1fr); }
    .grid-3 { grid-template-columns: repeat(2, 1fr); }
    .grid-2-1 { grid-template-columns: 1fr; }
    .grid-1-2 { grid-template-columns: 1fr; }
    .card-value { font-size: 24px; }
    .card-value.lg { font-size: 30px; }
  }
  @media (max-width: 560px) {
    .grid-4 { grid-template-columns: 1fr 1fr; }
    .grid-2 { grid-template-columns: 1fr; }
    .header { flex-direction: column; gap: 14px; align-items: flex-start; }
    .header-right { flex-wrap: wrap; }
  }

  /* â”€â”€ SCROLL CUSTOM â”€â”€ */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>

<div class="app">

  <!-- â•â•â• HEADER â•â•â• -->
  <header class="header">
    <div class="header-left">
      <div class="logo-mark">ğŸ½</div>
      <div>
        <div class="header-title">CHR 360Â°</div>
        <div class="header-subtitle">Le Bistrot du MarchÃ© â€” Tableau de Bord de Pilotage</div>
      </div>
    </div>
    <div class="header-right">
      <div class="badge-live"><div class="dot"></div>LIVE</div>
      <div class="date-chip" id="dateChip">â€”</div>
    </div>
  </header>

  <!-- â•â•â• PERIOD TABS â•â•â• -->
  <div class="period-tabs">
    <button class="tab" onclick="switchPeriod('semaine', this)">7 jours</button>
    <button class="tab active" onclick="switchPeriod('mois', this)">Ce mois</button>
    <button class="tab" onclick="switchPeriod('trimestre', this)">Trimestre</button>
  </div>

  <!-- â•â•â• KPIs PRINCIPAUX â•â•â• -->
  <div class="section-label">Performance</div>
  <div class="grid-4" id="kpiGrid">

    <div class="card">
      <div class="card-label">ğŸ“ˆ CA Total TTC</div>
      <div class="card-value lg" id="kpi-ca">â€”</div>
      <div class="card-sub">Chiffre d'affaires du mois</div>
      <div class="card-delta delta-up" id="kpi-ca-delta">â€”</div>
      <div class="accent-line"></div>
    </div>

    <div class="card">
      <div class="card-label">ğŸ‘¥ Couverts</div>
      <div class="card-value lg" id="kpi-couverts">â€”</div>
      <div class="card-sub">Ticket moyen : <span id="kpi-ticket" style="color:var(--text);font-weight:600">â€”</span></div>
      <div class="card-delta" id="kpi-ticket-delta">â€”</div>
      <div class="accent-line teal"></div>
    </div>

    <div class="card">
      <div class="card-label">ğŸ’° Food Cost</div>
      <div class="card-value lg" id="kpi-fc">â€”</div>
      <div class="card-sub">Objectif : <span id="kpi-fc-obj" style="color:var(--muted)">28,0%</span></div>
      <div class="card-delta" id="kpi-fc-delta">â€”</div>
      <div class="accent-line" id="fc-line"></div>
    </div>

    <div class="card">
      <div class="card-label">ğŸ’³ Ã‰chÃ©ances 30j</div>
      <div class="card-value lg" id="kpi-ech">â€”</div>
      <div class="card-sub">Ã€ rÃ©gler dans 30 jours</div>
      <div class="card-delta" id="kpi-ech-delta">â€”</div>
      <div class="accent-line orange"></div>
    </div>

  </div>

  <!-- â•â•â• JAUGES + SPARKLINE â•â•â• -->
  <div class="section-label" style="margin-top:28px">Ratios & Tendance CA</div>
  <div class="grid-3">

    <!-- JAUGE FOOD COST -->
    <div class="card">
      <div class="card-label">ğŸ¥© Food Cost vs Objectif</div>
      <div class="gauge-wrap">
        <svg class="gauge-svg" viewBox="0 0 140 80">
          <path class="gauge-track" d="M15,75 A55,55 0 0,1 125,75" />
          <path class="gauge-fill" id="gauge-fc-path" d="M15,75 A55,55 0 0,1 125,75"
            stroke="#f0a500" stroke-dasharray="173" stroke-dashoffset="173" />
          <text class="gauge-value" x="70" y="68" text-anchor="middle" id="gauge-fc-text">â€”</text>
        </svg>
        <div class="gauge-label">Food Cost rÃ©el</div>
        <div class="gauge-obj">Objectif max : 28,0%</div>
      </div>
    </div>

    <!-- JAUGE BEVERAGE COST -->
    <div class="card">
      <div class="card-label">ğŸº Beverage Cost vs Objectif</div>
      <div class="gauge-wrap">
        <svg class="gauge-svg" viewBox="0 0 140 80">
          <path class="gauge-track" d="M15,75 A55,55 0 0,1 125,75" />
          <path class="gauge-fill" id="gauge-bev-path" d="M15,75 A55,55 0 0,1 125,75"
            stroke="#4ecdc4" stroke-dasharray="173" stroke-dashoffset="173" />
          <text class="gauge-value" x="70" y="68" text-anchor="middle" id="gauge-bev-text">â€”</text>
        </svg>
        <div class="gauge-label">Beverage Cost rÃ©el</div>
        <div class="gauge-obj">Objectif max : 22,0%</div>
      </div>
    </div>

    <!-- SPARKLINE CA -->
    <div class="card">
      <div class="card-label">ğŸ“Š Tendance CA journalier (TTC)</div>
      <svg class="sparkline" id="sparkline" viewBox="0 0 300 50" preserveAspectRatio="none">
        <defs>
          <linearGradient id="sparkGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#f0a500" stop-opacity="0.3"/>
            <stop offset="100%" stop-color="#f0a500" stop-opacity="0"/>
          </linearGradient>
        </defs>
        <path class="sparkline-area" id="spark-area" fill="url(#sparkGrad)" />
        <path class="sparkline-line" id="spark-line" stroke="#f0a500" />
      </svg>
      <div style="display:flex;justify-content:space-between;margin-top:6px">
        <span style="font-size:10px;color:var(--dim)" id="spark-min">min â€”</span>
        <span style="font-size:10px;color:var(--dim)" id="spark-max">max â€”</span>
        <span style="font-size:10px;color:var(--dim)" id="spark-avg">moy â€”</span>
      </div>
    </div>

  </div>

  <!-- â•â•â• RÃ‰PARTITION ACHATS + MARGE â•â•â• -->
  <div class="section-label" style="margin-top:28px">Achats & Marges</div>
  <div class="grid-2-1">

    <!-- BARCHART ACHATS PAR CATÃ‰GORIE -->
    <div class="card">
      <div class="card-label">ğŸ›’ RÃ©partition achats par catÃ©gorie (HT)</div>
      <div class="chart-area" id="achats-chart">
        <!-- GÃ©nÃ©rÃ© par JS -->
      </div>
    </div>

    <!-- MARGE ESTIMÃ‰E -->
    <div class="card">
      <div class="card-label">ğŸ“ Compte de rÃ©sultat simplifiÃ©</div>
      <div style="display:flex;flex-direction:column;gap:12px;margin-top:8px" id="pnl-block">
        <!-- GÃ©nÃ©rÃ© par JS -->
      </div>
    </div>

  </div>

  <!-- â•â•â• TRÃ‰SORERIE PRÃ‰VISIONNELLE â•â•â• -->
  <div class="section-label" style="margin-top:28px">TrÃ©sorerie PrÃ©visionnelle â€” 60 jours</div>
  <div class="grid-2">

    <div class="card" style="padding:20px">
      <div class="card-label">ğŸ”´ Ã‰chÃ©ances urgentes â€” 0 Ã  30 jours</div>
      <div class="timeline" id="timeline-30">
        <!-- GÃ©nÃ©rÃ© par JS -->
      </div>
    </div>

    <div class="card" style="padding:20px">
      <div class="card-label">ğŸŸ¡ Ã‰chÃ©ances Ã  planifier â€” 31 Ã  60 jours</div>
      <div class="timeline" id="timeline-60">
        <!-- GÃ©nÃ©rÃ© par JS -->
      </div>
    </div>

  </div>

  <!-- â•â•â• ALERTES â•â•â• -->
  <div class="section-label" style="margin-top:28px">Alertes & Recommandations</div>
  <div id="alertes-block">
    <!-- GÃ©nÃ©rÃ© par JS -->
  </div>

  <!-- â•â•â• TABLE DERNIÃˆRES FACTURES â•â•â• -->
  <div class="section-label" style="margin-top:28px">DerniÃ¨res Factures TraitÃ©es</div>
  <div class="card" style="padding:0;overflow:hidden">
    <div class="table-wrap">
      <table id="table-factures">
        <thead>
          <tr>
            <th>Fournisseur</th>
            <th>CatÃ©gorie</th>
            <th>Date</th>
            <th>Ã‰chÃ©ance</th>
            <th>Montant TTC</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <!-- GÃ©nÃ©rÃ© par JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- â•â•â• TABLE DERNIÃˆRES VENTES â•â•â• -->
  <div class="section-label" style="margin-top:28px">Derniers Z de Caisse TraitÃ©s</div>
  <div class="card" style="padding:0;overflow:hidden">
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Service</th>
            <th>CA TTC</th>
            <th>Couverts</th>
            <th>Ticket Moyen</th>
            <th>CA Bar</th>
            <th>Annulations</th>
          </tr>
        </thead>
        <tbody id="table-ventes">
          <!-- GÃ©nÃ©rÃ© par JS -->
        </tbody>
      </table>
    </div>
  </div>

  <hr class="divider">

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-left">PropulsÃ© par <strong>n8n</strong> + <strong>GPT-4o Vision</strong> + <strong>Google Sheets</strong></div>
    <div class="footer-right">
      <span class="footer-tag">CHR 360Â° v1.0</span>
      <span class="footer-tag">AUTO-REFRESH 15min</span>
    </div>
  </footer>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DONNÃ‰ES DE DÃ‰MO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const DATA = {
  mois: {
    achats: [
      { fournisseur:'METRO Cash & Carry',         cat:'ALIMENTAIRE', date:'2025-01-06', echeance:'2025-02-05', ht:1243.60, ttc:1439.20, statut:'EN_ATTENTE', mode:'PRELEVEMENT' },
      { fournisseur:'Brasserie Kronenbourg',       cat:'BOISSONS',    date:'2025-01-08', echeance:'2025-01-23', ht:687.40,  ttc:756.14,  statut:'EN_ATTENTE', mode:'VIREMENT'    },
      { fournisseur:'Ecolab France SAS',           cat:'ENTRETIEN',   date:'2025-01-10', echeance:'2025-02-09', ht:312.00,  ttc:374.40,  statut:'EN_ATTENTE', mode:'PRELEVEMENT' },
      { fournisseur:'Transgourmet France',         cat:'ALIMENTAIRE', date:'2025-01-12', echeance:'2025-02-11', ht:892.30,  ttc:991.00,  statut:'EN_ATTENTE', mode:'VIREMENT'    },
      { fournisseur:'Evian Volvic Restauration',   cat:'BOISSONS',    date:'2025-01-14', echeance:'2025-01-29', ht:244.00,  ttc:268.40,  statut:'PAYE',       mode:'PRELEVEMENT' },
      { fournisseur:'Thiriet SurgelÃ©s Pro',        cat:'ALIMENTAIRE', date:'2025-01-15', echeance:'2025-02-14', ht:567.80,  ttc:646.30,  statut:'EN_ATTENTE', mode:'CHEQUE'      },
    ],
    ventes: [
      { date:'2025-01-06', service:'JOURNEE', caTTC:3120.40, caHT:2865.12, couverts:82,  ticket:38.05, caBar:682.40,  annuls:0     },
      { date:'2025-01-07', service:'JOURNEE', caTTC:3847.60, caHT:3534.12, couverts:98,  ticket:39.26, caBar:842.00,  annuls:42.50 },
      { date:'2025-01-08', service:'JOURNEE', caTTC:4213.80, caHT:3869.42, couverts:112, ticket:37.62, caBar:920.00,  annuls:0     },
      { date:'2025-01-09', service:'JOURNEE', caTTC:2980.40, caHT:2735.22, couverts:74,  ticket:40.28, caBar:680.40,  annuls:28.00 },
      { date:'2025-01-10', service:'JOURNEE', caTTC:4580.20, caHT:4205.68, couverts:118, ticket:38.82, caBar:1012.20, annuls:0     },
      { date:'2025-01-11', service:'JOURNEE', caTTC:5210.60, caHT:4787.72, couverts:134, ticket:38.88, caBar:1145.60, annuls:55.00 },
    ]
  }
};

const CFG = {
  objectifFoodCost:    0.28,
  objectifBevCost:     0.22,
  objectifTicketMoyen: 38.00,
  alerteTresorerie:    2000,
  tauxChargesFixes:    0.35,
  tauxPersonnel:       0.30,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const fmt  = v => new Intl.NumberFormat('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}).format(v) + ' â‚¬';
const fmtK = v => v >= 1000 ? (v/1000).toFixed(1).replace('.',',') + 'k â‚¬' : fmt(v);
const fmtP = v => (v*100).toFixed(1).replace('.',',') + '%';
const fmtI = v => Math.round(v).toLocaleString('fr-FR');
const qs   = s => document.querySelector(s);
const diff = (d1,d2) => Math.ceil((new Date(d2)-new Date(d1))/(86400000));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function compute(data) {
  const v = data.ventes, a = data.achats;

  const caTTC     = v.reduce((s,x)=>s+x.caTTC,0);
  const caHT      = v.reduce((s,x)=>s+x.caHT,0);
  const couverts  = v.reduce((s,x)=>s+x.couverts,0);
  const ticketMoy = couverts > 0 ? caTTC/couverts : 0;
  const caBar     = v.reduce((s,x)=>s+x.caBar,0);
  const annuls    = v.reduce((s,x)=>s+x.annuls,0);
  const jours     = v.length;
  const caMoyJ    = jours > 0 ? caTTC/jours : 0;

  const alimHT = a.filter(x=>x.cat==='ALIMENTAIRE').reduce((s,x)=>s+x.ht,0);
  const boisHT = a.filter(x=>x.cat==='BOISSONS').reduce((s,x)=>s+x.ht,0);
  const entrHT = a.filter(x=>x.cat==='ENTRETIEN').reduce((s,x)=>s+x.ht,0);
  const totalHT= a.reduce((s,x)=>s+x.ht,0);

  const foodCost = caHT>0 ? alimHT/caHT : 0;
  const bevCost  = caHT>0 ? boisHT/caHT : 0;
  const totalCost= caHT>0 ? totalHT/caHT : 0;
  const margeB   = Math.max(0, 1 - totalCost - CFG.tauxChargesFixes - CFG.tauxPersonnel);

  const now = new Date();
  const f30 = new Date(now); f30.setDate(f30.getDate()+30);
  const f60 = new Date(now); f60.setDate(f60.getDate()+60);

  const ech30 = a.filter(x=> { const d=new Date(x.echeance); return d>=now && d<=f30 && x.statut!=='PAYE'; });
  const ech60 = a.filter(x=> { const d=new Date(x.echeance); return d>f30  && d<=f60 && x.statut!=='PAYE'; });
  const tot30 = ech30.reduce((s,x)=>s+x.ttc,0);
  const tot60 = ech60.reduce((s,x)=>s+x.ttc,0);

  return {
    caTTC, caHT, couverts, ticketMoy, caBar, annuls, jours, caMoyJ,
    alimHT, boisHT, entrHT, totalHT,
    foodCost, bevCost, totalCost, margeB,
    ech30, ech60, tot30, tot60,
    echeancesTotal: tot30+tot60,
    catBreak: [
      { label:'Alimentaire', val:alimHT, color:'#f0a500' },
      { label:'Boissons',    val:boisHT, color:'#4ecdc4' },
      { label:'Entretien',   val:entrHT, color:'#8888a0' },
    ]
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render(periodKey) {
  const data = DATA[periodKey] || DATA.mois;
  const k = compute(data);

  // Date chip
  qs('#dateChip').textContent = new Date().toLocaleDateString('fr-FR',{day:'2-digit',month:'short',year:'numeric'});

  // â”€ KPI: CA
  animateValue('kpi-ca', k.caTTC, v => fmtK(v));
  qs('#kpi-ca-delta').className = 'card-delta delta-up';
  qs('#kpi-ca-delta').textContent = 'â–² +8,4% vs mois prÃ©c.';

  // â”€ KPI: Couverts
  animateValue('kpi-couverts', k.couverts, v => fmtI(v));
  qs('#kpi-ticket').textContent = fmt(k.ticketMoy);
  const tmDelta = qs('#kpi-ticket-delta');
  if (k.ticketMoy >= CFG.objectifTicketMoyen) {
    tmDelta.className = 'card-delta delta-up';
    tmDelta.textContent = 'â–² Objectif atteint (' + fmt(CFG.objectifTicketMoyen) + ')';
  } else {
    tmDelta.className = 'card-delta delta-warn';
    tmDelta.textContent = 'â–¼ Sous objectif (' + fmt(CFG.objectifTicketMoyen) + ')';
  }

  // â”€ KPI: Food Cost
  animateValue('kpi-fc', k.foodCost*100, v => v.toFixed(1).replace('.',',')+' %');
  const fcDelta = qs('#kpi-fc-delta');
  const fcLine  = qs('#fc-line');
  if (k.foodCost > CFG.objectifFoodCost) {
    fcDelta.className = 'card-delta delta-down';
    fcDelta.textContent = 'â–¼ +' + ((k.foodCost-CFG.objectifFoodCost)*100).toFixed(1) + 'pt vs objectif';
    fcLine.className = 'accent-line red';
  } else {
    fcDelta.className = 'card-delta delta-up';
    fcDelta.textContent = 'â–² Objectif respectÃ© âœ“';
    fcLine.className = 'accent-line green';
  }

  // â”€ KPI: Ã‰chÃ©ances
  animateValue('kpi-ech', k.tot30, v => fmtK(v));
  const echDelta = qs('#kpi-ech-delta');
  if (k.tot30 > CFG.alerteTresorerie) {
    echDelta.className = 'card-delta delta-down';
    echDelta.textContent = 'âš  DÃ©passe le seuil d\'alerte';
  } else {
    echDelta.className = 'card-delta delta-up';
    echDelta.textContent = 'âœ“ Sous le seuil d\'alerte';
  }

  // â”€ Jauges
  setTimeout(() => {
    renderGauge('gauge-fc-path', 'gauge-fc-text', k.foodCost, CFG.objectifFoodCost, k.foodCost > CFG.objectifFoodCost ? '#e74c3c' : '#f0a500');
    renderGauge('gauge-bev-path', 'gauge-bev-text', k.bevCost, CFG.objectifBevCost, k.bevCost > CFG.objectifBevCost ? '#e74c3c' : '#4ecdc4');
  }, 300);

  // â”€ Sparkline
  renderSparkline(data.ventes.map(v=>v.caTTC));

  // â”€ Bar Chart Achats
  const maxAchat = Math.max(...k.catBreak.map(c=>c.val), 1);
  qs('#achats-chart').innerHTML = k.catBreak.map(c => `
    <div class="bar-row">
      <div class="bar-row-label">${c.label}</div>
      <div class="bar-track">
        <div class="bar-fill" style="background:${c.color};width:0%" data-target="${(c.val/maxAchat*100).toFixed(1)}%"></div>
      </div>
      <div class="bar-amount">${fmt(c.val)}</div>
    </div>
  `).join('');
  setTimeout(() => {
    document.querySelectorAll('.bar-fill').forEach(el => {
      el.style.width = el.dataset.target;
    });
  }, 400);

  // â”€ P&L Block
  const pnlRows = [
    { label:'CA HT', val:k.caHT, pct:1, color:'var(--accent)', bold:true },
    { label:'- Mat. premiÃ¨res', val:-k.totalHT, pct:-k.totalCost, color:'var(--red)' },
    { label:'= Marge brute', val:k.caHT-k.totalHT, pct:1-k.totalCost, color:'var(--accent3)', bold:true },
    { label:'- Charges fixes', val:-(k.caHT*CFG.tauxChargesFixes), pct:-CFG.tauxChargesFixes, color:'var(--red)' },
    { label:'- Personnel', val:-(k.caHT*CFG.tauxPersonnel), pct:-CFG.tauxPersonnel, color:'var(--red)' },
    { label:'â‰ˆ RÃ©sultat net est.', val:k.caHT*k.margeB, pct:k.margeB, color:k.margeB>0?'var(--green)':'var(--red)', bold:true },
  ];
  qs('#pnl-block').innerHTML = pnlRows.map(r => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border)">
      <span style="font-size:12px;color:var(--muted);${r.bold?'font-weight:600;color:var(--text)':''}">${r.label}</span>
      <div style="text-align:right">
        <span style="font-family:var(--font-mono);font-size:12px;font-weight:600;color:${r.color}">${fmt(Math.abs(r.val))}</span>
        <span style="font-size:10px;color:var(--dim);margin-left:6px">${fmtP(Math.abs(r.pct))}</span>
      </div>
    </div>
  `).join('');

  // â”€ Timelines TrÃ©sorerie
  renderTimeline('timeline-30', k.ech30, true);
  renderTimeline('timeline-60', k.ech60, false);

  // â”€ Alertes
  renderAlertes(k);

  // â”€ Tables
  renderTableFactures(data.achats);
  renderTableVentes(data.ventes);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAUGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGauge(pathId, textId, value, maxRef, color) {
  const totalLen = 173;
  const pct = Math.min(value / (maxRef * 1.5), 1); // max visuel = 1.5Ã— objectif
  const offset = totalLen - (totalLen * pct);
  const el = qs('#' + pathId);
  el.style.stroke = color;
  el.style.strokeDashoffset = offset;
  qs('#' + textId).textContent = fmtP(value);
  qs('#' + textId).style.fill = color;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPARKLINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSparkline(values) {
  if (!values.length) return;
  const W = 300, H = 50, pad = 4;
  const min = Math.min(...values), max = Math.max(...values);
  const range = max - min || 1;
  const pts = values.map((v,i) => [
    (i / (values.length-1)) * W,
    H - pad - ((v-min)/range)*(H-pad*2)
  ]);
  const line = pts.map((p,i)=>(i===0?'M':'L')+p[0].toFixed(1)+','+p[1].toFixed(1)).join(' ');
  const area = line + ` L${W},${H} L0,${H} Z`;
  qs('#spark-line').setAttribute('d', line);
  qs('#spark-area').setAttribute('d', area);
  const avg = values.reduce((a,b)=>a+b,0)/values.length;
  qs('#spark-min').textContent = 'min ' + fmtK(min);
  qs('#spark-max').textContent = 'max ' + fmtK(max);
  qs('#spark-avg').textContent = 'moy ' + fmtK(avg);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMELINE TRÃ‰SORERIE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTimeline(id, echs, urgent) {
  const el = qs('#' + id);
  if (!echs.length) {
    el.innerHTML = `<div style="text-align:center;color:var(--dim);font-size:12px;padding:20px">âœ… Aucune Ã©chÃ©ance</div>`;
    return;
  }
  const color = urgent ? 'var(--red)' : 'var(--orange)';
  el.innerHTML = echs.map(e => {
    const jours = diff(new Date().toISOString().slice(0,10), e.echeance);
    return `
    <div class="timeline-item">
      <div class="timeline-dot" style="background:${color}"></div>
      <div class="timeline-date">${new Date(e.echeance+'T12:00:00').toLocaleDateString('fr-FR',{day:'2-digit',month:'short'})}</div>
      <div>
        <div class="timeline-name">${e.fournisseur}</div>
        <div class="timeline-cat">${e.cat} Â· ${e.mode}</div>
      </div>
      <div class="timeline-amount" style="color:${color}">${fmt(e.ttc)}</div>
      <div class="timeline-days" style="color:${color}">J-${jours}</div>
    </div>
    `;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAlertes(k) {
  const alertes = [];
  if (k.foodCost > CFG.objectifFoodCost) {
    alertes.push({
      cls:'alert-danger', icon:'â›”',
      title: `Food Cost trop Ã©levÃ© : ${fmtP(k.foodCost)} (objectif ${fmtP(CFG.objectifFoodCost)})`,
      desc: 'Analysez vos achats alimentaires, rÃ©duisez les pertes et revoyez vos portions. Chaque point gagnÃ© sur le food cost reprÃ©sente un gain direct de marge.'
    });
  }
  if (k.tot30 > CFG.alerteTresorerie) {
    alertes.push({
      cls:'alert-warn', icon:'ğŸ’³',
      title: `Ã‰chÃ©ances 30j : ${fmt(k.tot30)} Ã  dÃ©caisser`,
      desc: 'Anticipez vos rÃ¨glements fournisseurs. VÃ©rifiez votre solde de trÃ©sorerie actuel et planifiez les virements prioritaires.'
    });
  }
  if (k.ticketMoy < CFG.objectifTicketMoyen * 0.9) {
    alertes.push({
      cls:'alert-warn', icon:'ğŸ“‰',
      title: `Ticket moyen en baisse : ${fmt(k.ticketMoy)} (objectif ${fmt(CFG.objectifTicketMoyen)})`,
      desc: 'Formez votre Ã©quipe aux suggestions de vente et aux upsells (vins, desserts, cafÃ©s). +2â‚¬/ticket = +5kâ‚¬/an sur 100 couverts/j.'
    });
  }
  if (!alertes.length) {
    alertes.push({
      cls:'alert-ok', icon:'âœ…',
      title:'Tous les indicateurs sont dans les normes',
      desc:'Excellente gestion ce mois-ci. Continuez Ã  piloter vos coÃ»ts et Ã  monitorer vos Ã©chÃ©ances fournisseurs.'
    });
  }
  qs('#alertes-block').innerHTML = alertes.map((a,i) => `
    <div class="alert-card ${a.cls}" style="animation-delay:${i*0.1}s">
      <div class="alert-icon">${a.icon}</div>
      <div class="alert-text">
        <strong>${a.title}</strong>
        <span>${a.desc}</span>
      </div>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTableFactures(achats) {
  const pillClass = { 'EN_ATTENTE':'pill-orange', 'PAYE':'pill-green', 'EN_RETARD':'pill-red', 'LITIGE':'pill-red' };
  const pillLabel = { 'EN_ATTENTE':'En attente', 'PAYE':'PayÃ©', 'EN_RETARD':'En retard', 'LITIGE':'Litige' };
  const catColor  = { 'ALIMENTAIRE':'#f0a500','BOISSONS':'#4ecdc4','ENTRETIEN':'#8888a0','EMBALLAGE':'#e05c5c','MATERIEL':'#aaaaff' };
  qs('#table-body').innerHTML = achats.map(f => `
    <tr>
      <td style="font-weight:500">${f.fournisseur}</td>
      <td><span style="font-size:10px;font-weight:600;color:${catColor[f.cat]||'var(--muted)'}">${f.cat}</span></td>
      <td class="mono">${new Date(f.date+'T12:00:00').toLocaleDateString('fr-FR')}</td>
      <td class="mono">${new Date(f.echeance+'T12:00:00').toLocaleDateString('fr-FR')}</td>
      <td class="mono" style="font-weight:600">${fmt(f.ttc)}</td>
      <td><span class="pill ${pillClass[f.statut]||'pill-blue'}">${pillLabel[f.statut]||f.statut}</span></td>
    </tr>
  `).join('');
}

function renderTableVentes(ventes) {
  qs('#table-ventes').innerHTML = ventes.map(v => `
    <tr>
      <td class="mono">${new Date(v.date+'T12:00:00').toLocaleDateString('fr-FR')}</td>
      <td><span class="pill pill-blue">${v.service}</span></td>
      <td class="mono" style="font-weight:600;color:var(--accent)">${fmt(v.caTTC)}</td>
      <td class="mono">${v.couverts}</td>
      <td class="mono">${fmt(v.ticket)}</td>
      <td class="mono">${fmt(v.caBar)}</td>
      <td class="mono" style="color:${v.annuls>0?'var(--red)':'var(--dim)'}">${v.annuls>0?'-'+fmt(v.annuls):'â€”'}</td>
    </tr>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANIMATE VALUE (counter)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function animateValue(id, target, formatter) {
  const el = qs('#' + id);
  let start = 0, duration = 1000, startTime = null;
  function step(ts) {
    if (!startTime) startTime = ts;
    const progress = Math.min((ts - startTime) / duration, 1);
    const eased = 1 - Math.pow(1 - progress, 3);
    el.textContent = formatter(start + (target - start) * eased);
    if (progress < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SWITCH PERIOD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchPeriod(period, btn) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  // Simulation de donnÃ©es diffÃ©rentes selon la pÃ©riode
  if (period === 'semaine') {
    const week = {
      achats: DATA.mois.achats.slice(0,2),
      ventes: DATA.mois.ventes.slice(0,2)
    };
    DATA._tmp = week;
    render('_tmp');
  } else if (period === 'trimestre') {
    // Multiplier les donnÃ©es pour simuler un trimestre
    const q = {
      achats: [...DATA.mois.achats, ...DATA.mois.achats.map(a=>({...a,ht:a.ht*0.95,ttc:a.ttc*0.95}))],
      ventes: [...DATA.mois.ventes, ...DATA.mois.ventes.map(v=>({...v,caTTC:v.caTTC*1.08,caHT:v.caHT*1.08,couverts:Math.round(v.couverts*1.1)}))]
    };
    DATA._tmp = q;
    render('_tmp');
  } else {
    render('mois');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARD GLOW EFFECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('mousemove', e => {
  document.querySelectorAll('.card').forEach(card => {
    const rect = card.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top)  / rect.height) * 100;
    card.style.setProperty('--mouse-x', x + '%');
    card.style.setProperty('--mouse-y', y + '%');
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => render('mois'));
</script>
</body>
</html>
